<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
  layout:decorator="mainLayout">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Tree Management</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body>
    <div layout:fragment="content">
	
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-lg-10">
                    <h2>Tree Management</h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="index.html">Home</a>
                        </li>
                        <li class="active">
                            <strong>Tree Management</strong>
                        </li>
                    </ol>
                </div>
                <div class="col-lg-2">

                </div>
            </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Tree List</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li><a href="#">Config option 1</a>
                                </li>
                                <li><a href="#">Config option 2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">

                    <div class="table-responsive">
					<table id="treeTable" class="table table-striped table-bordered table-hover" >
						<thead>
							<tr>
								<th>Tree Id</th>
								<th>User Id</th>
								<th>Tree Name</th>
								<th>Description</th>
								<th>Item Status Code</th>
								<th>Detail</th>
								<th>Accecpt</th>
							</tr>
						</thead>
						<!-- tbody 태그 필요 없다. -->
					</table>
                    </div>
                    </div>
                    
<button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#myModal" onClick="showCreateTreeModal();">Create</button>                    
                    
                    
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Tree Information</h4>
      </div>
      <div class="modal-body">
        <table>
			<tr>
			  <td>TreeId</td>
			  <td id="table-treeid"></td>
			</tr>
			<tr>
			  <td>UserId</td>
			  <td><input id="table-userid" type="text" value=""/></td>
			</tr>
			<tr>
			  <td>TreeName</td>
			  <td><input id="table-treename" type="text" value=""/></td>
			</tr>
			<tr>
			  <td>Description</td>
			  <td><input id="table-description" type="text" value=""/></td>
			</tr>
			<tr>
			  <td>Item Status Code</td>
			  <td><input id="table-itemstatuscode" type="text" value=""/></td>
			</tr>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" style="display:none" class="btn btn-primary" id="button_updateTree">Update</button>
        <button type="button" style="display:none" class="btn btn-primary" data-dismiss="modal" id="button_removeTree">Delete</button>
        <button type="button" style="display:none" class="btn btn-primary" data-dismiss="modal" id="button_createTree">Create</button>
      </div>
    </div>
  </div>
</div>                    
                    
                    
                    
                </div>
            </div>
            </div>
</div>
        

	<!-- datatables -->
    <script src="js/plugins/dataTables/datatables.min.js"></script>
    <script src="js/plugins/peity/jquery.peity.min.js"></script>


    <!-- Page-Level Scripts -->
    <script>
	    var treeTable;
	    
	    function showCreateTreeModal() {
	    		$('#table-treeid').html("AUTO");
			$('#table-userid').val('');
			$('#table-treename').val('');
			$('#table-description').val('');
			$('#table-itemstatuscode').val('');

			$("#button_createTree").show();
	    		$("#button_updateTree").hide();
    			$("#button_removeTree").hide();
	    }
	    
	    $('#button_createTree').click(function(){
	    		//validation check
	    		
	    		//ajax
			$.ajax({
				url: "/treeMgmt/insertTree.do",
				type: "get",
				data: {
					userId				: $('#table-userid').val(),
					treeName			: $('#table-treename').val(),
					description		: $('#table-description').val(),
					itemStatusCode	: $('#table-itemstatuscode').val()
				},
		        success:function(result){
					console.log("success : insert", result);
					//toast 같은게 필요ㅎㅎ 
					$('#treeTable').DataTable().ajax.reload();
		        } 
			});	    	
	    	
	    })
	    
	    $('#button_updateTree').click(function(){
			$.ajax({
				url: "/treeMgmt/updateTree.do",
				type: "get",
				data: {
					treeId			: $('#table-treeid').html(),
					userId			: $('#table-userid').val(),
					treeName			: $('#table-treename').val(),
					description		: $('#table-description').val(),
					itemStatusCode	: $('#table-itemstatuscode').val()
				},
		        success:function(result){
					console.log("success : update", result);
					$('#treeTable').DataTable().ajax.reload();
		        } 
			});
	    })	    
	    
	    $('#button_removeTree').click(function(){
	    		var param_treeId = $('#table-treeid').html();
	    		
			$.ajax({
				url: "/treeMgmt/removeTree.do",
				type: "get",
				data: {
					treeId : param_treeId
				},
		        success:function(result){
					console.log("success : remove", result);
					$('#treeTable').DataTable().ajax.reload();
		        } 
			});
	    })
	    
	    function accecptTree(treeId){
	    		alert(treeId + "tree accepted");
	    }
	    
	    function viewTreeDetail(treeId){
			$.ajax({
				url: "/treeMgmt/selectOneTree.do",
				type: "get",
				data: {
					treeId : treeId
				},
		        success:function(result){
					console.log("result", result);
					$('#table-treeid').html(treeId);
					$('#table-userid').val(result.data.userId);
					$('#table-treename').val(result.data.treeName);
					$('#table-description').val(result.data.description);
					$('#table-itemstatuscode').val(result.data.itemStatusCode);
		        } 
			});
			
	    		$("#button_createTree").hide();
	    		$("#button_updateTree").show();
    			$("#button_removeTree").show();
			
	    }
	    
	    function setTreeTable(){
	    	treeTable = $('#treeTable').dataTable({
				pageLength: 1,
				pagingType : "full_numbers",
				bPaginate: true,
				bLengthChange: true,
				lengthMenu : [ [ 1, 3, 5, 10, -1 ], [ 1, 3, 5, 10, "All" ] ],
				responsive: true,
				bAutoWidth: false,
				processing: true,
				ordering: true,
				serverSide: true,
				searching: false,
		        ajax : {
		            "url": "/treeMgmt/getTreeList.do",
		            "type":"POST",
		            "data": function ( d ) {
		               // d.repoType = $("#repoType option:selected").val(),
		               // d.repoName = $("#repoName").val(),
		            }
		         },
				columns : [					//target
					{data: "treeId"},		//0
					{data: "userId"},		//1
					{data: "treeName"},		//2
					{data: "description"},	//3
					{data: "itemStatusCode"},//4
					{data: "treeId"},		//5번 컬럼의 파라미터라는 의
					{data: "treeId"}			//6
				],
				columnDefs : [
					{
		                "targets": 5,
		                "render": function(data,type,row){
		                	//return '<button class="btn btn-info btn-xs" onClick="viewTreeDetail('+data+');">'+'DETAIL'+'</button>'
		                	return '<button type="button" class="btn btn-info btn-xs" data-toggle="modal" data-target="#myModal" onClick="viewTreeDetail('+data+');">'+'DETAIL'+'</button>'
		                },
		                className: "text-center",
		                "orderable": false
		            },
					{
		                "targets": 6,
		                "render": function(data,type,row){
		                	return '<button class="btn btn-success btn-xs" onClick="accecptTree('+data+');">'+'ACCEPT'+'</button>'
		                },
		                "className": "text-center",
		                "orderable": false
		            },
		            {
		                "targets": [0],
		                "visible": true
		            }
		        ],
		        dom: '<"html5buttons"B>lTfgtip',
		        buttons: [
	 	            {extend: 'copy'},
		            {extend: 'csv'},
		            {extend: 'excel', title: 'ExampleFile'},
		            {extend: 'pdf', title: 'ExampleFile'},
		            {extend: 'print',
		             customize: function (win){
		                    $(win.document.body).addClass('white-bg');
		                    $(win.document.body).css('font-size', '10px');
		
		                    $(win.document.body).find('table')
		                            .addClass('compact')
		                            .css('font-size', 'inherit');
		            }
		            } 
		        ]
		
		    });
	    }
	    $(document).ready(function(){
	    	setTreeTable();
	    });
    </script>
    </div>

</body>

</html>